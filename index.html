<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Jam Catur Profesional</title>
  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    html, body { height: 100%; margin: 0; background:#0d1117; color:#f0f6fc; }
    body { display:flex; flex-direction:column; height:100vh; }
    .segment { flex:1; display:flex; align-items:center; justify-content:center; }
    .switch-btn { width:100%; height:100%; background:#161b22; border:none; font-size:1.2rem; font-weight:600; color:#58a6ff; }
    .switch-btn:active { background:#21262d; }
    .timer { font-size:4rem; font-weight:700; letter-spacing:1px; }
    .rotated { transform:rotate(180deg); }
    .settings-btn { position:absolute; top:10px; right:10px; }
    .small-note { font-size:0.8rem; opacity:0.8; }
  </style>
</head>
<body>
  <!-- Segmen 1: tombol untuk player 2 selesai → aktifkan player 1 -->
  <div class="segment rotated">
    <button id="switch1" class="switch-btn">DONE</button>
  </div>
  <!-- Segmen 2: timer player 2 (rotated) -->
  <div class="segment bg-dark rotated">
    <div class="text-center">
      <div id="name2" class="small-note">Hitam</div>
      <div id="time2" class="timer">05:00</div>
    </div>
  </div>
  <!-- Segmen 3: timer player 1 -->
  <div class="segment bg-dark">
    <div class="text-center">
      <div id="name1" class="small-note">Putih</div>
      <div id="time1" class="timer">05:00</div>
    </div>
  </div>
  <!-- Segmen 4: tombol untuk player 1 selesai → aktifkan player 2 -->
  <div class="segment">
    <button id="switch2" class="switch-btn">DONE</button>
  </div>

  <button class="btn btn-sm btn-outline-light settings-btn" data-bs-toggle="modal" data-bs-target="#settingsModal">⚙️</button>

  <!-- Settings Modal -->
  <div class="modal fade" id="settingsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content bg-dark text-light">
        <div class="modal-header">
          <h5 class="modal-title">Pengaturan Jam Catur</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="settingsForm">
            <div class="mb-3">
              <label class="form-label">Waktu awal (menit)</label>
              <input type="number" id="minutesInput" class="form-control" value="5" min="1">
            </div>
            <div class="mb-3">
              <label class="form-label">Increment (detik)</label>
              <input type="number" id="incrementInput" class="form-control" value="0" min="0">
            </div>
            <div class="mb-3">
              <label class="form-label">Delay (detik)</label>
              <input type="number" id="delayInput" class="form-control" value="0" min="0">
            </div>
            <div class="mb-3">
              <label class="form-label">Nama pemain</label>
              <div class="d-flex gap-2">
                <input id="player1Name" class="form-control" value="Putih">
                <input id="player2Name" class="form-control" value="Hitam">
              </div>
            </div>
            <div class="mb-3 d-flex gap-3">
              <div class="form-check">
                <input type="radio" name="mode" id="modeCountdown" value="countdown" class="form-check-input" checked>
                <label for="modeCountdown" class="form-check-label">Countdown</label>
              </div>
              <div class="form-check">
                <input type="radio" name="mode" id="modeCountup" value="countup" class="form-check-input">
                <label for="modeCountup" class="form-check-label">Count-up</label>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
          <button id="saveSettings" type="button" class="btn btn-primary">Simpan</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    let initialSeconds = 300;
    let incrementSeconds = 0;
    let delaySeconds = 0;
    let mode = 'countdown';

    let remaining = {1: initialSeconds, 2: initialSeconds};
    let activePlayer = null;
    let running = false;
    let lastTick = null;
    let delayLeft = {1:0,2:0};
    let timer = null;

    const timeEls = {1: document.getElementById('time1'), 2: document.getElementById('time2')};

    function format(sec){
      if(sec<0) sec=0;
      let m = Math.floor(sec/60);
      let s = Math.floor(sec%60);
      return `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
    }

    function render(){
      timeEls[1].textContent = format(remaining[1]);
      timeEls[2].textContent = format(remaining[2]);
    }

    function step(){
      const now = performance.now();
      const dt = (now - lastTick)/1000;
      lastTick = now;
      if(delayLeft[activePlayer]>0){
        delayLeft[activePlayer]-=dt;
        if(delayLeft[activePlayer]<0) delayLeft[activePlayer]=0;
      } else {
        if(mode==='countdown'){
          remaining[activePlayer]-=dt;
          if(remaining[activePlayer]<=0){
            remaining[activePlayer]=0;
            stop();
          }
        } else {
          remaining[activePlayer]+=dt;
        }
      }
      render();
    }

    function start(){
      if(running) return;
      running = true;
      lastTick = performance.now();
      timer = setInterval(step,100);
    }
    function stop(){
      running = false;
      clearInterval(timer);
      timer=null;
    }
    function reset(){
      stop();
      remaining[1]=initialSeconds;
      remaining[2]=initialSeconds;
      delayLeft[1]=delayLeft[2]=delaySeconds;
      activePlayer=null;
      render();
    }

    function activatePlayer(player) {
      if (!running) start();
      if (activePlayer !== null) {
        remaining[activePlayer] += incrementSeconds;
      }
      activePlayer = player;
      delayLeft[player] = delaySeconds;
      render();
    }

    // Tombol atas → aktifkan Player 1
    document.getElementById('switch1').addEventListener('click', () => {
      activatePlayer(1);
    });
    // Tombol bawah → aktifkan Player 2
    document.getElementById('switch2').addEventListener('click', () => {
      activatePlayer(2);
    });

    document.getElementById('saveSettings').addEventListener('click',()=>{
      initialSeconds = parseInt(document.getElementById('minutesInput').value||5)*60;
      incrementSeconds = parseInt(document.getElementById('incrementInput').value||0);
      delaySeconds = parseFloat(document.getElementById('delayInput').value||0);
      mode = document.querySelector('input[name="mode"]:checked').value;
      document.getElementById('name1').textContent=document.getElementById('player1Name').value||'Putih';
      document.getElementById('name2').textContent=document.getElementById('player2Name').value||'Hitam';
      reset();
      bootstrap.Modal.getInstance(document.getElementById('settingsModal')).hide();
    });

    render();
  </script>
</body>
</html>
