<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title></title>
  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    :root {
      --bg-color: #ffffff;
      --text-color: #0d1117;
      --segment-bg: #f8f9fa;
      --btn-bg: #e9ecef;
      --btn-text: #0d6efd;
      --btn-active: #ced4da;
    }

    body.dark-mode {
      --bg-color: #0d1117;
      --text-color: #f0f6fc;
      --segment-bg: #161b22;
      --btn-bg: #161b22;
      --btn-text: #58a6ff;
      --btn-active: #21262d;
    }

    html, body { height: 100%; margin: 0; background: var(--bg-color); color: var(--text-color); }
    body { display:flex; flex-direction:column; height:100vh; }
    .segment { flex:1; display:flex; align-items:center; justify-content:center; }
    .pause-segment {flex: 0 0 10%;} /* tinggi segmen pause */
    .switch-btn, .pause-btn { width:100%; height:100%; background: var(--btn-bg); border:none; font-size:1.2rem; font-weight:600; color: var(--btn-text); }
    .switch-btn:active, .pause-btn:active { background: var(--btn-active); }
    .timer { font-size:3.5rem; font-weight:700; letter-spacing:1px; }
    .rotated { transform:rotate(180deg); }
    .settings-btn { position:absolute; top:10px; right:10px; }
    .small-note { font-size:0.8rem; opacity:0.8; }
    .segment.bg-dark { background: var(--segment-bg) !important; }
  </style>
</head>
<body>
  <!-- Segmen 1: tombol untuk player 2 selesai ‚Üí aktifkan player 1 -->
  <div class="segment rotated">
    <button id="switch1" class="switch-btn">DONE</button>
  </div>
  <!-- Segmen 2: timer player 2 (rotated) -->
  <div class="segment bg-dark rotated">
    <div class="text-center">
      <div id="name2" class="small-note">Hitam</div>
      <div id="time2" class="timer">05:00</div>
    </div>
  </div>
  <!-- Segmen 3: tombol pause -->
  <div class="segment pause-segment">
    <button id="pauseBtn" class="pause-btn">‚è∏Ô∏è PAUSE</button>
  </div>
  <!-- Segmen 4: timer player 1 -->
  <div class="segment bg-dark">
    <div class="text-center">
      <div id="name1" class="small-note">Putih</div>
      <div id="time1" class="timer">05:00</div>
    </div>
  </div>
  <!-- Segmen 5: tombol untuk player 1 selesai ‚Üí aktifkan player 2 -->
  <div class="segment">
    <button id="switch2" class="switch-btn">DONE</button>
  </div>

  <!-- Settings button -->
  <button class="btn btn-sm btn-outline-light settings-btn" data-bs-toggle="modal" data-bs-target="#settingsModal">‚öôÔ∏è</button>
  <!-- Theme toggle button -->
  <button id="themeToggle" class="btn btn-sm btn-outline-light settings-btn" style="right:50px;">üåô</button>

  <!-- Settings Modal -->
  <div class="modal fade" id="settingsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content bg-dark text-light">
        <div class="modal-header">
          <h5 class="modal-title">Pengaturan Jam Catur</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="settingsForm">
            <div class="mb-3">
              <label class="form-label">Waktu awal (menit)</label>
              <input type="number" id="minutesInput" class="form-control" value="5" min="1">
            </div>
            <div class="mb-3">
              <label class="form-label">Increment (detik)</label>
              <input type="number" id="incrementInput" class="form-control" value="0" min="0">
            </div>
            <div class="mb-3">
              <label class="form-label">Delay (detik)</label>
              <input type="number" id="delayInput" class="form-control" value="0" min="0">
            </div>
            <div class="mb-3">
              <label class="form-label">Nama pemain</label>
              <div class="d-flex gap-2">
                <input id="player1Name" class="form-control" value="Putih">
                <input id="player2Name" class="form-control" value="Hitam">
              </div>
            </div>
            <div class="mb-3 d-flex gap-3">
              <div class="form-check">
                <input type="radio" name="mode" id="modeCountdown" value="countdown" class="form-check-input" checked>
                <label for="modeCountdown" class="form-check-label">Countdown</label>
              </div>
              <div class="form-check">
                <input type="radio" name="mode" id="modeCountup" value="countup" class="form-check-input">
                <label for="modeCountup" class="form-check-label">Count-up</label>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
          <button id="saveSettings" type="button" class="btn btn-primary">Simpan</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Audio -->
  <audio id="clickSound" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>
  <audio id="endSound" src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg"></audio>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    let initialSeconds = 300;
    let incrementSeconds = 0;
    let delaySeconds = 0;
    let mode = 'countdown';

    let remaining = {1: initialSeconds, 2: initialSeconds};
    let activePlayer = null;
    let running = false;
    let lastTick = null;
    let delayLeft = {1:0,2:0};
    let timer = null;

    const timeEls = {1: document.getElementById('time1'), 2: document.getElementById('time2')};
    const clickSound = document.getElementById('clickSound');
    const endSound = document.getElementById('endSound');

    function format(sec){
      if(sec<0) sec=0;
      let m = Math.floor(sec/60);
      let s = Math.floor(sec%60);
      return `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
    }

    function render(){
      timeEls[1].textContent = format(remaining[1]);
      timeEls[2].textContent = format(remaining[2]);
    }

    function step(){
      const now = performance.now();
      const dt = (now - lastTick)/1000;
      lastTick = now;
      if(delayLeft[activePlayer]>0){
        delayLeft[activePlayer]-=dt;
        if(delayLeft[activePlayer]<0) delayLeft[activePlayer]=0;
      } else {
        if(mode==='countdown'){
          remaining[activePlayer]-=dt;
          if(remaining[activePlayer]<=0){
            remaining[activePlayer]=0;
            stop();
            endSound.play();
          }
        } else {
          remaining[activePlayer]+=dt;
        }
      }
      render();
    }

    function start(){
      if(running) return;
      running = true;
      lastTick = performance.now();
      timer = setInterval(step,100);
    }
    function stop(){
      running = false;
      clearInterval(timer);
      timer=null;
    }
    function reset(){
      stop();
      remaining[1]=initialSeconds;
      remaining[2]=initialSeconds;
      delayLeft[1]=delayLeft[2]=delaySeconds;
      activePlayer=null;
      render();
    }

    function activatePlayer(player) {
      if (!running) start();
      if (activePlayer !== null) {
        remaining[activePlayer] += incrementSeconds;
      }
      activePlayer = player;
      delayLeft[player] = delaySeconds;
      render();
      clickSound.play();
    }

    // Tombol atas ‚Üí aktifkan Player 1
    document.getElementById('switch1').addEventListener('click', () => {
      activatePlayer(1);
    });
    // Tombol bawah ‚Üí aktifkan Player 2
    document.getElementById('switch2').addEventListener('click', () => {
      activatePlayer(2);
    });
    // Tombol pause
    document.getElementById('pauseBtn').addEventListener('click', () => {
      if(running) {
        stop();
        document.getElementById('pauseBtn').textContent = "‚ñ∂Ô∏è RESUME";
      } else {
        start();
        document.getElementById('pauseBtn').textContent = "‚è∏Ô∏è PAUSE";
      }
    });

    document.getElementById('saveSettings').addEventListener('click',()=>{
      initialSeconds = parseInt(document.getElementById('minutesInput').value||5)*60;
      incrementSeconds = parseInt(document.getElementById('incrementInput').value||0);
      delaySeconds = parseFloat(document.getElementById('delayInput').value||0);
      mode = document.querySelector('input[name="mode"]:checked').value;
      document.getElementById('name1').textContent=document.getElementById('player1Name').value||'Putih';
      document.getElementById('name2').textContent=document.getElementById('player2Name').value||'Hitam';
      reset();
      bootstrap.Modal.getInstance(document.getElementById('settingsModal')).hide();
    });

    // === THEME TOGGLE ===
    function updateThemeIcon() {
      const btn = document.getElementById("themeToggle");
      if (document.body.classList.contains("dark-mode")) {
        btn.textContent = "üåô"; // dark
      } else {
        btn.textContent = "‚òÄÔ∏è"; // light
      }
    }

    // Load theme dari localStorage
    if (localStorage.getItem("theme") === "light") {
      document.body.classList.remove("dark-mode");
    } else {
      document.body.classList.add("dark-mode"); // default dark
    }
    updateThemeIcon();

    document.getElementById("themeToggle").addEventListener("click", () => {
      document.body.classList.toggle("dark-mode");
      if (document.body.classList.contains("dark-mode")) {
        localStorage.setItem("theme", "dark");
      } else {
        localStorage.setItem("theme", "light");
      }
      updateThemeIcon();
    });

    render();
  </script>
</body>
</html>
